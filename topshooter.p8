pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--topshooter
--by eduszesz

function _init()
	t=0
	p={x=64,y=64,sp=1,dx=0,dy=0}
	bullets={}
	smoke={}
end

function _update()
	t+=1
	p.dx=0
	p.dy=0
	if btn(⬆️) then
		p.dy=-1
		if not btn(🅾️) then
			p.sp=1
		end
	end
	if btn(⬇️) then
		p.dy=1
		if not btn(🅾️) then
			p.sp=5
		end	
	end
	if btn(⬅️) then
		p.dx=-1
		if not btn(🅾️) then
			p.sp=3
		end	
	end
	if btn(➡️) then
		p.dx=1
		if not btn(🅾️) then
			p.sp=7
		end	
	end
	if btnp(❎) then
		fire()
	end
	p.x+=p.dx
	p.y+=p.dy
	updbullets()
	updsmoke()
end

function _draw()
	cls(15)
	if p.dx!=0 or p.dy!=0 then
		if t%8<4 then
			spr(p.sp+1,p.x,p.y)
		else
			spr(p.sp,p.x,p.y)		
		end
	else
		spr(p.sp,p.x,p.y)
	end
	drbullets()
	drsmoke()
end

function updbullets()
	for b in all(bullets) do
		if t%3==0 then
			b.sp+=1
			if b.sp>10 then
				b.sp=9
			end
		end
		b.x+=b.dx
		b.y+=b.dy
		if b.x<0 or b.x>128
			or b.y<0 or b.y>128 then
			del(bullets,b)
		end	
	end
end

function updsmoke()
	for s in all(smoke) do
		s.r-=1
		if s.r<0 then
			del(smoke,s)
		end
	end
end

function drbullets()
	for b in all(bullets) do
		spr(b.sp,b.x,b.y)
	end
end

function drsmoke()
	for s in all(smoke) do
		circfill(s.x,s.y,s.r,7)
	end
end

function fire()
	local dx,dy=0,-1
	local ox,oy=2,-4
	if p.sp==5 or p.sp==6 then
		dx,dy=0,1
		ox,oy=-2,4
	end
	if p.sp==3 or p.sp==4 then
		dx,dy=-1,0
		ox,oy=-2,-2
	end
	if p.sp==7 or p.sp==8 then
		dx,dy=1,0
		ox,oy=2,1
	end
	local b={x=p.x+ox,
										y=p.y+oy,
										sp=9,
										dx=dx*6,
										dy=dy*6
										}
	add(bullets,b)
	mksmoke(ox,oy)
end

function mksmoke(_ox,_oy)
	local ox,oy=_ox,_oy
	local s={r=5,x=p.x+ox,y=p.y+oy}
	add(smoke,s)
end
__gfx__
0000000000000500000000000000000000000bbd00033d00db33d000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000d00000000500000bbd005d5555b0db44b00b544b000000000000000000000000000000ff0000000000000000000000000000000000000000000
0070070000000500000000d05d5555b00000b4430b544b00b544b000dbbbd000000000000008800000f88f000000000000000000000000000000000000000000
0007700000dbb50000000050000b04430000b4430b500b0005bbd0003440b000dbbd0000008778000f8ee8f00000000000000000000000000000000000000000
0007700000b005b0000dbb50000b04430000dbbd005bbd00050000003440b000344b00000087e8000f8ee8f00000000000000000000000000000000000000000
0070070000b445b0000b445b000dbbbd00000000005000000d0000000b5555d5344b00000008800000f88f000000000000000000000000000000000000000000
0000000000b44bd0000b445b000000000000000000d00000050000000dbb0000b5555d5000000000000ff0000000000000000000000000000000000000000000
0000000000d33000000d33bd0000000000000000005000000000000000000000dbb0000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000004000404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
