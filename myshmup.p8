pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
--my shmup
--by eduszesz

function _init()
	t=0
	ship={
		sp=2,
		x=64,
		y=64,
		sx=0,
		sy=0,
		fl=4}
		
	stars={}
	bullets={}
	enemies={}
	e_bullets={}
	smokes={}
	
	mkstars()
		
end

function _update()
	t+=1
	ship.sp=2
	ship.sx=0
	ship.sy=0
	if btn(0) then
		ship.sp=1
		ship.sx=-3
	end
	if btn(1) then
		ship.sp=3
		ship.sx=3
	end
	if btn(2) then
		ship.sy=-3
	end
	if btn(3) then
		ship.sy=3
	end
	
	ship.x+=ship.sx
	ship.y+=ship.sy
	
	if ship.x<0 then
		ship.x=0
	end
	if ship.x>120 then
		ship.x=120
	end
	
	if ship.y<0 then
		ship.y=0
	end
	if ship.y>120 then
		ship.y=120
	end
	if t%4<2 then
		ship.fl=5
	else
		ship.fl=4
	end
	
	if btnp(4) then
		fire()
		mksmoke()
		sfx(1)
	end
	
	
	--update bullets
	for b in all(bullets) do
		b.y+=b.sy
		if b.y<-10 then
			del(bullets,b)
		end
	end
	
	
	
		
end

function _draw()
	cls()
	--stars
	for s in all(stars) do
		s.y+=s.sy
		if s.y>128 then
			s.y=-10
			s.x=rnd(128)
		end
		pset(s.x,s.y,s.cl)
	end
	
	--player
	spr(ship.sp,ship.x,ship.y)
	spr(ship.fl,ship.x,ship.y+8)
	
	--bullets
	for b in all(bullets) do
		if t%4<2 then
			b.sp=6
		else
			b.sp=7
		end
		spr(b.sp,b.x,b.y)
	end
	
	--smokes
	for sk in all(smokes) do
		if sk.age>0 then
			sk.age-=1
		end
		circfill(ship.x+3,ship.y-1,sk.age,sk.cl)
		if sk.age<=0 then
			del(smokes,sk)
		end
	end
	
	
end

function mkstars()
	for i=1,100 do
		local s={
									x=rnd(128),
									y=rnd(128),
									sy=rnd(2)+1,
									cl=flr(rnd(4)+7)}
		if rnd()>0.3 then
			s.cl=7
		end
		if s.sy<2 then
			s.cl=13
		end						
		add(stars,s)							
	end
end


function fire()
	local b={
								sp=6,
								x=ship.x,
								y=ship.y-4,
								sx=0,
								sy=-5}
	add(bullets,b)
end

function mksmoke()
	local sk={
								cl=7,
								age=5}
	add(smokes,sk)
end

__gfx__
0000000000d61000000d60000001d600000170000009100000099000000990000000000000000000000000000000000000000000000000000000000000000000
0000000001d61050501d61050501d6100087a800008a9800009aa90000977900000ee00000000000000000000000000000000000000000000000000000000000
00700700016611616116611616116610008a9800008980000097a900009a790000ecce0000000000000000000000000000333300000000000000000000000000
000770000dc6d16161dccd16161d6cd0008980000008000000977900009aa90007eeee7000000000000000000000000003c33c30000000000000000000000000
0007700006c666616667c66616666c60000800000000080000099000000990000eeeeee000000000000000000000000033333333000000000000000000000000
007007000576566166577566166567500000000000000000000090000009000000cccc0000000000000000000000000083333338000000000000000000000000
0000000006556610166556610166556000000000000000000090000000000900000ee00000000000000000000000000000999900000000000000000000000000
000000000dadd10001daad10001ddad000000000000000000000a000000a00000000000000000000000000000000000000000000000000000000000000000000
0000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600600000000000000000000000000
b00000b00000000000000000000000000b000b000000000000000000000000000000000000000000000000000000000000066000000000000000000000000000
0bbbbb0000000000000000000000000000bbb0000000000000000000000000000808808000000000000000000000000000666600000000000000000000000000
0b707b000000000000000000000000000bbbbb00000000000000000000000000008888000000000000000000000000000665cb60000000000000000000000000
0bb66b0000000000000000000000000007667b0000000000000000000000000008b88b8000000000000000000000000006bcbc60000000000000000000000000
00bbbbb00000000000000000000000000b66bb0000000000000000000000000088888888000000000000000000000000006bc600000000000000000000000000
0b00000b000000000000000000000000bbaaaab000000000000000000000000080aaaa0800000000000000000000000006565660000000000000000000000000
b0000000000000000000000000000000b00000b000000000000000000000000000000000000000000000000000000000068aa860000000000000000000000000
__sfx__
000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
19020000220001a0511701113021100310e0410b0410a051070510406102061020710000000501005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500
