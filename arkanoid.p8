pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
--arkanoid
--by eduszesz

function _init()
	local pw,ph,bw,bh=16,4,4,4
	p={sp=1,
					x=(128-16)/2,
					y=120,
					dx=0,
					w=pw,
					h=ph,
					dir=true, 
					box={x1=0,y1=0,x2=pw-1,y2=3}}
	b={sp=3,
					x=p.x+(pw-bw)/2,
					y=p.y-ph,
					w=bw,
					h=bh,
					dx=1,
					dy=1,
					v=3,
					ang=0.125,
					box={x1=0,y1=0,x2=3,y2=3}}
	
	bs="on pad" -- ball state
	bricks={}
	lvl={{1,1,0,0,1,1,1,1},
						{1,1,1,0,0,1,1,1},
						{1,1,1,1,0,0,1,1},
						{1,1,1,1,1,0,0,1},
							}
	
	read_lvl()
	
	ffield={}
	for x=1,128,16 do
		
			local ff={x=x,
					y=128-rnd(3),
					c=10,
					}
			add(ffield,ff)
		
	end
	
	t=0
end

function _update()
	t+=1
	p.dx=0

	if btn(⬅️) then
		p.dx=-4
		p.dir=true
	end
	if btn(➡️) then
		p.dx=4
		p.dir=false
	end
	p.x+=p.dx
	
	if p.x<1 then p.x=1 end
	if p.x>(127-p.w) then p.x=(127-p.w) end
	
	
	if bs=="on pad" then
		b.x=p.x+5
		if p.dir then
			b.dx=-1
		else
			b.dx=1
		end
	end
	
	if btnp(5) then
		bs = "moving"
	end
	if bs=="moving" then
		
		if b.x>122 or b.x<1 then
			if b.x<1 then b.x=1 end
			if b.x>122 then b.x=122 end
			reflect("x")
		end
		if b.y>123 or b.y<1 then
			reflect("y")
		end
		
		if coll(p,b) then
			if b.y+4>(p.y+1) then
				b.y=p.y-5
			end
			reflect("y")
			
			if p.dx!=0 then
				reflect("x")
			end
			
			if b.x<(p.x+3) or
				b.x>(p.x+p.w-3) then
				b.ang=0.07
				reflect("x")
			else	
				b.ang=0.1+rnd(0.15)
			end
		end
		
		for br in all(bricks) do
			if coll(b,br) then
				reflect("x")
				reflect("y")
				del(bricks,br)
				b.ang=0.1+rnd(0.15)
			end
		end
		
		b.x+=b.v*b.dx*cos(b.ang)
		b.y+=b.v*b.dy*sin(b.ang)
	end
	
	if btnp(4) then
		_init()
	end
	
	if t%8<4 then
		for ff in all(ffield) do
			ff.x=ff.x+sin(t/2)
			ff.y=ff.y+cos(t/2)
			
		end
	end	
	
end

function _draw()
	cls()
	rrect(p.x,p.y,p.w,p.h,2,11)
	rrect(b.x,b.y,b.w,b.h,2,11)
	--spr(p.sp,p.x,p.y,2,1)
	--spr(b.sp,b.x,b.y)
	rect(0,0,127,127,7)
	--rect(p.x+p.box.x1,p.y+p.box.y1,p.x+p.box.x2,p.y+p.box.y2,10)
	--rect(b.x+b.box.x1,b.y+b.box.y1,b.x+b.box.x2,b.y+b.box.y2,10)
	for br in all(bricks) do
		rrect(br.x,br.y,15,7,0,br.c)
	end
	if bs=="on pad" then
		line(b.x+2,b.y,b.x+10*b.dx*cos(b.amg),b.y+10*b.dy*sin(b.ang),8)
	end
	
	for i=1,#ffield-1 do
		local f1=ffield[i]
		local f2=ffield[i+1]
		line(f1.x,f1.y,f2.x,f2.y,10)
	end
	line(ffield[#ffield].x,ffield[#ffield].y,128,128,10)
	
	print(b.ang,8)
end

function reflect(_dir) --_dir ="x" or "y"
	local dir=_dir
	if dir=="x" then
		if b.dx==1 then
			b.dx=-1
		else
			b.dx=1
		end
	end
	if dir=="y" then
		if b.dy==1 then
			b.dy=-1
		else
			b.dy=1
		end
	end
end

--collision
function abs_box(s)
 local box = {}
 box.x1 = s.box.x1 + s.x
 box.y1 = s.box.y1 + s.y
 box.x2 = s.box.x2 + s.x
 box.y2 = s.box.y2 + s.y
 return box

end

function coll(a,b)
 
 local box_a = abs_box(a)
 local box_b = abs_box(b)
 
 if box_a.x1 > box_b.x2 or
    box_a.y1 > box_b.y2 or
    box_b.x1 > box_a.x2 or
    box_b.y1 > box_a.y2 then
    return false
 end
 return true 
end
function first_lvl()
	for x=1,128,16 do
		for y=16,40,8 do
			local br={x=x,
					y=y,
					c=12,
					box={x1=0,y1=0,x2=15,y2=7}}
			add(bricks,br)
		end
	end
end

function read_lvl()
	for x=1,#lvl[1] do
		for y=1,#lvl do
			if lvl[y][x]==1 then
				local br={x=(-15+x*16),
														y=(-7+y*8),
														c=12,
														box={x1=0,y1=0,x2=15,y2=7}}
				add(bricks,br)
			end									
		end
	end
end

__gfx__
00000000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000611111111111111600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700055555555555555000055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000566500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000566500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
700cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc7
70c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
70c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c
700cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc7
700cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc7
70c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
70c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c
700cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc7
700cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc7
70c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
7c000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000000cc000007
70c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c00c0000c
700cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc0000cccc7
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000008800000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000008800000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000b80000000000000000000000000000000000000000000000000000000000000007
7000000000000000000000000000000000000000000000000000000000000b00b000000000000000000000000000000000000000000000000000000000000007
7000000000000000000000000000000000000000000000000000000000000b00b000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000bb0000000000000000000000000000000000000000000000000000000000000007
700000000000000000000000000000000000000000000000000000000bbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000b00000000000000b00000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000b00000000000000b00000000000000000000000000000000000000000000000000000007
700000000000000000000000000000000000000000000000000000000bbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777

